<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Sci-Fi Cube with Laser (JS)</title>
<style>
  body {
    margin: 0; height: 100vh;
    background: black;
    display: flex; justify-content: center; align-items: center;
    overflow: hidden;
    font-family: 'Orbitron', sans-serif;
    color: #00ffea;
    perspective: 800px;
  }
  #scene {
    position: relative;
    width: 200px; height: 200px;
  }
  #cube {
    width: 150px; height: 150px;
    position: relative;
    transform-style: preserve-3d;
    margin: auto;
  }
  #cube div {
    position: absolute;
    width: 150px; height: 150px;
    border: 2px solid #00ffea;
    background: rgba(0, 255, 234, 0.1);
    box-shadow: 0 0 20px #00ffea;
    display: flex; justify-content: center; align-items: center;
  }
  #cube .front::before {
    content: "";
    width: 70px; height: 70px;
    border-radius: 50%;
    background: #00ffea;
    box-shadow: 0 0 30px cyan;
    position: relative;
    z-index: 1;
  }
  #cube .front  { transform: translateZ(75px); }
  #cube .back   { transform: rotateY(180deg) translateZ(75px); }
  #cube .right  { transform: rotateY(90deg) translateZ(75px); }
  #cube .left   { transform: rotateY(-90deg) translateZ(75px); }
  #cube .top    { transform: rotateX(90deg) translateZ(75px); }
  #cube .bottom { transform: rotateX(-90deg) translateZ(75px); }

  #laser {
    position: fixed;
    width: 6px;
    height: 20px;
    background: #00fff0;
    box-shadow: 0 0 10px #00fff0, 0 0 20px #00fff0;
    border-radius: 2px;
    transform-origin: top center;
    pointer-events: none;
  }
</style>
</head>
<body>
<div id="scene">
  <div id="cube">
    <div class="front"></div>
    <div class="back"></div>
    <div class="right"></div>
    <div class="left"></div>
    <div class="top"></div>
    <div class="bottom"></div>
  </div>
</div>
<div id="laser"></div>

<script>
  // Constants
  const cube = document.getElementById('cube');
  const laser = document.getElementById('laser');
  const scene = document.getElementById('scene');

  // Cube rotation state
  let rotX = 0;
  let rotY = 0;

  // Animation parameters
  const rotationSpeedX = 0.5; // degrees per frame approx
  const rotationSpeedY = 1;

  // Convert degrees to radians
  function degToRad(deg) {
    return deg * Math.PI / 180;
  }

  // Calculate front face position and direction in screen coords
  function getFrontFaceVector() {
    // Cube center on screen
    const rect = scene.getBoundingClientRect();
    const centerX = rect.left + rect.width / 2;
    const centerY = rect.top + rect.height / 2;

    // Calculate rotation matrices for current angles
    const rx = degToRad(rotX);
    const ry = degToRad(rotY);

    // Front face normal vector in cube local space is (0,0,1)
    // Apply rotations around X and Y axes
    const cosX = Math.cos(rx), sinX = Math.sin(rx);
    const cosY = Math.cos(ry), sinY = Math.sin(ry);

    // Rotate (0,0,1) by rotX around X-axis
    let x1 = 0;
    let y1 = -sinX;
    let z1 = cosX;

    // Rotate result by rotY around Y-axis
    let x2 = cosY * x1 + sinY * z1;
    let y2 = y1;
    let z2 = -sinY * x1 + cosY * z1;

    return {centerX, centerY, dirX: x2, dirY: y2, dirZ: z2};
  }

  // Animate cube rotation and laser beam
  function animate() {
    rotX = (rotX + rotationSpeedX) % 360;
    rotY = (rotY + rotationSpeedY) % 360;

    cube.style.transform = `rotateX(${rotX}deg) rotateY(${rotY}deg)`;

    const {centerX, centerY, dirX, dirY, dirZ} = getFrontFaceVector();

    // Only shoot laser if front face roughly facing forward (dirZ > 0)
    if (dirZ > 0) {
      // Calculate laser position - start just in front of cube center
      const laserStartX = centerX + dirX * 75;
      const laserStartY = centerY - dirY * 75;

      laser.style.left = laserStartX + 'px';
      laser.style.top = laserStartY + 'px';

      // Calculate laser length - to edge of screen in that direction
      const maxDistance = Math.max(window.innerWidth, window.innerHeight) * 1.5;

      // Normalize direction in 2D screen space
      const vecLength = Math.sqrt(dirX*dirX + dirY*dirY);
      const normX = dirX / vecLength;
      const normY = -dirY / vecLength; // invert Y for screen coordinates

      // Calculate rotation angle for laser rectangle (CSS rotates clockwise)
      const angle = Math.atan2(normY, normX) * 180 / Math.PI;

      laser.style.width = '6px';
      laser.style.height = maxDistance + 'px';
      laser.style.transform = `translate(-50%, 0) rotate(${angle}deg)`;

      laser.style.opacity = '1';
    } else {
      // Hide laser when front face not facing viewer
      laser.style.opacity = '0';
    }

    requestAnimationFrame(animate);
  }

  animate();
</script>
</body>
</html>
